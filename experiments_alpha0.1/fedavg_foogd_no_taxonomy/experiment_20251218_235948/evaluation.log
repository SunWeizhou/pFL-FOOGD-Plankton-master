使用设备: cuda
CUDA_VISIBLE_DEVICES: 0

================================================================================
测试 FedRoD 模型性能
实验: ./experiments_alpha0.1/fedavg_foogd_no_taxonomy/experiment_20251218_235948
配置: Alpha=0.1, FOOGD=True, 客户端数=5
================================================================================

步骤1: 使用轻量级版本获取数据分布信息...
创建轻量级联邦学习数据加载器（只加载标签信息）...
[train] 从缓存加载 26034 个标签
客户端 0: 3768 样本
客户端 1: 7980 样本
客户端 2: 7509 样本
客户端 3: 5025 样本
客户端 4: 1752 样本
[test] 从缓存加载 2939 个标签
[near_ood] 从缓存加载 1516 个标签
[far_ood] 从缓存加载 17031 个标签
轻量级联邦学习数据加载器创建完成:
  - 客户端数量: 5
  - 测试集: 2939 样本
  - Near-OOD: 1516 样本
  - Far-OOD: 17031 样本
[train] 从缓存加载 26034 个标签

步骤2: 使用完整版本进行实际评估...
[test] 发现缓存文件: ./Plankton_OOD_Dataset/cache_test.pkl
[test] 缓存校验通过，已加载 2939 张图片。
[test] 已加载 2939 张图片
创建客户端本地测试集（与训练集分布一致）...
  客户端 0: 本地测试集大小=566
  客户端 1: 本地测试集大小=381
  客户端 2: 本地测试集大小=262
  客户端 3: 本地测试集大小=796
  客户端 4: 本地测试集大小=934
  有效客户端数量: 5/5

步骤3: 创建完整的数据加载器用于评估...
[test] 发现缓存文件: ./Plankton_OOD_Dataset/cache_test.pkl
[test] 缓存校验通过，已加载 2939 张图片。
[test] 已加载 2939 张图片
[near_ood] 发现缓存文件: ./Plankton_OOD_Dataset/cache_near_ood.pkl
[near_ood] 缓存校验通过，已加载 1516 张图片。
[near_ood] 已加载 1516 张图片
[far_ood] 发现缓存文件: ./Plankton_OOD_Dataset/cache_far_ood.pkl
[far_ood] 缓存校验通过，已加载 17031 张图片。
[far_ood] 已加载 17031 张图片
[test] 发现缓存文件: ./Plankton_OOD_Dataset/cache_test.pkl
[test] 缓存校验通过，已加载 2939 张图片。
[test] 已加载 2939 张图片
测试数据加载器创建完成:
  - 测试集: 2939 样本
  - Near-OOD: 1516 样本
  - Far-OOD: 17031 样本
  - IN-C (OOD泛化测试): 2939 样本
加载检查点: ./experiments_alpha0.1/fedavg_foogd_no_taxonomy/experiment_20251218_235948/best_model.pth
算法类型: FedAvg (只有全局模型)
FedAvg 算法没有客户端个性化状态

--------------------------------------------------------------------------------
评估 Head-G (通用头) 性能
--------------------------------------------------------------------------------
ID 准确率: 0.9217
置信度均值: 0.9334 ± 0.1376
尾部类别准确率: 0.7765
层级错误: 0.0338
层级准确率: 0.9932

--------------------------------------------------------------------------------
FedAvg 算法只有全局模型 (Head-G)，没有个性化 Head-P
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
评估 OOD 检测性能 (基于 Head-G)
--------------------------------------------------------------------------------
Near-OOD AUROC: 0.2417
ID 分数: 10.0274 ± 1.4242
Near-OOD 分数: 11.2944 ± 1.2287
Far-OOD AUROC: 0.1301
ID 分数: 10.0274 ± 1.4242
Far-OOD 分数: 12.2430 ± 1.3780

================================================================================
结果汇总
================================================================================
指标                   | FedAvg (Head-G) | 备注
--------------------------------------------------------------------------------
ID准确率                | 0.9217          | 全局模型准确率
尾部准确率                | 0.7765          | 尾部类别准确率
层级准确率                | 0.9932          | 层级准确率
Near-OOD AUROC       | 0.2417          | 基于 FOOGD 模块
Far-OOD AUROC        | 0.1301          | 基于 FOOGD 模块
================================================================================

详细结果已保存到: ./experiments_alpha0.1/fedavg_foogd_no_taxonomy/experiment_20251218_235948/performance_evaluation.json
